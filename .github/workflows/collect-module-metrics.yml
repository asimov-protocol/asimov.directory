name: Collect Metrics

on:
  schedule:
    - cron: '*/15 * * * *'  # Every 15 minutes
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  collect-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Zuplo metrics collection
        env:
          ZUPLO_API_BASE_URL: ${{ vars.ZUPLO_API_BASE_URL }}
        run: |
          curl --silent --show-error -f -X GET \
            -H "Authorization: Bearer ${{ secrets.ZUPLO_COLLECTOR_API_KEY }}" \
            $ZUPLO_API_BASE_URL/internal/metrics/asimov-modulues
        
      - name: Check if succeeded
        if: success()
        run: echo "✅ Metrics collected successfully"
        
      - name: Alert on failure
        if: failure()
        run: echo "❌ Failed to collect metrics"
